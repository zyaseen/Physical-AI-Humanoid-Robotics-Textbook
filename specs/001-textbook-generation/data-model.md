# Data Model: Physical AI & Humanoid Robotics Textbook

**Feature**: 001-textbook-generation
**Date**: 2025-12-10

## Entities

### Textbook Chapter
- **ID**: String (unique identifier for the chapter)
- **Title**: String (title of the chapter)
- **Content**: String (the actual chapter content in Markdown format)
- **ChapterNumber**: Integer (order of the chapter in the textbook)
- **Slug**: String (URL-friendly identifier)
- **CreatedAt**: DateTime (timestamp when chapter was created)
- **UpdatedAt**: DateTime (timestamp when chapter was last updated)
- **Status**: Enum (DRAFT, PUBLISHED, ARCHIVED)

### RAG Chatbot
- **ID**: String (unique identifier for the chatbot instance)
- **Name**: String (name of the chatbot)
- **Description**: String (brief description of the chatbot's purpose)
- **CreatedAt**: DateTime (timestamp when chatbot was created)

### User Query
- **ID**: String (unique identifier for the query)
- **QueryText**: String (the original query from the user)
- **ResponseText**: String (the response generated by the chatbot)
- **SourceChapters**: Array<String> (list of chapter IDs that contributed to the response)
- **Timestamp**: DateTime (when the query was made)
- **SessionID**: String (to group related queries)
- **QueryType**: Enum (GENERAL, SELECTED_TEXT, NAVIGATION)

### External Service (Configuration)
- **ID**: String (unique identifier for the service)
- **ServiceType**: Enum (QDRANT, NEON, FASTAPI, LLM_API)
- **ServiceName**: String (name of the service)
- **EndpointURL**: String (API endpoint for the service)
- **APIKey**: String (API key for the service, stored securely)
- **ConfigParams**: JSON (additional configuration parameters)
- **CreatedAt**: DateTime (when the config was created)
- **UpdatedAt**: DateTime (when the config was last updated)

### User Session
- **ID**: String (unique session identifier)
- **StartTime**: DateTime (when the session started)
- **LastActivity**: DateTime (when the last activity occurred)
- **UserAgent**: String (browser information, if any)
- **IPAddress**: String (IP address for analytics, not personal identification)

## Relationships

1. **Textbook Chapter** → **User Query** (one-to-many)
   - A chapter can be referenced by multiple user queries

2. **RAG Chatbot** → **User Query** (one-to-many)
   - A chatbot instance can process multiple user queries

3. **User Session** → **User Query** (one-to-many)
   - A session can contain multiple queries

## Validation Rules

1. **Textbook Chapter**:
   - Title and Content are required
   - ChapterNumber must be between 1 and 6 (as per spec)
   - Slug must be unique

2. **User Query**:
   - QueryText is required and must be between 5 and 2000 characters
   - ResponseText must not be empty
   - Timestamp must be current or past
   - SourceChapters must reference valid chapters

3. **External Service**:
   - ServiceType, ServiceName, and EndpointURL are required
   - EndpointURL must be a valid URL
   - ConfigParams must be valid JSON

## State Transitions

1. **Textbook Chapter**:
   - DRAFT → PUBLISHED (when content is ready for public access)
   - PUBLISHED → DRAFT (when content is being updated)
   - Any state → ARCHIVED (when chapter is no longer needed)

## Indexes

1. **Textbook Chapter**:
   - Index on ChapterNumber for ordering
   - Index on Slug for fast URL lookup

2. **User Query**:
   - Index on Timestamp for chronological queries
   - Index on SessionID for session-based analytics

3. **External Service**:
   - Index on ServiceType for fast filtering